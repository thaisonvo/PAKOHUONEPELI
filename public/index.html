<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kotisivu - Pakohuonepelit</title>
</head>

<body>
    <div class="container">
        <div class="text-content" style="text-align: center;">

            <div class="mb-3">
                <h1>Tervetuloa pakohuonepeliin!</h1>
            </div>

            <div class="mb-3">
                <select id="allEscapeRooms">
                    <!-- All existing escape rooms are placed here -->
                </select>
            </div>
            
            <div class="mb-3">
                <button id="startGameButton">Aloita peli</button>
            </div>

        </div>
    </div>

    <script>
        async function fetchData() {
            try {
                const response = await fetch("/allEscapeRooms");
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Error:", error);
                alert("Tapahtui odottamaton virhe. Yritä myöhemmin uudelleen.");
            }
        }

        function renderDropdownMenu(data, id) {
            const dropdownMenu = document.getElementById(id);
            
            data.forEach(room => {
                const option = document.createElement("option");
                option.value = room.title;
                option.innerText = room.title;
                dropdownMenu.appendChild(option);
            })
        }

        function startGame(escapeRoom) {
            try {
                window.location.href = `/maingamepage?escapeRoom=${encodeURIComponent(escapeRoom)}`;
            } catch (error) {
                console.error("Error", error);
                alert("Tapahtui odottamaton virhe. Yritä myöhemmin uudelleen.");
            }
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const allEscapeRooms = await fetchData();

            if (!allEscapeRooms) {
                console.error("Failed to retrieve existing Escape Rooms");
                return;
            }

            renderDropdownMenu(allEscapeRooms, "allEscapeRooms");

            const dropdownMenu = document.getElementById("allEscapeRooms");
            let selectedEscapeRoom = dropdownMenu.value;

            dropdownMenu.addEventListener("change", () => {
                selectedEscapeRoom = dropdownMenu.value;
            })

            const startGameButton = document.getElementById("startGameButton");
            startGameButton.addEventListener("click", () => {
                startGame(selectedEscapeRoom);
            })
        })
    </script>
</body>
</html>